<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Movie Show â€“ Seat Booking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      text-align: center;
      padding: 20px;
    }
    .screen {
      background: #333;
      color: #fff;
      padding: 10px;
      margin: 20px auto;
      width: 60%;
      border-radius: 6px;
    }
    .row {
      margin-bottom: 10px;
    }
    .seat {
      width: 44px;
      height: 44px;
      margin: 4px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      background: #4caf50;
      color: #fff;
    }
    .seat.booked {
      background: #e74c3c;
      cursor: not-allowed;
    }
    .seat.selected {
      background: #f1c40f;
      color: #000;
    }
    input, button {
      padding: 8px;
      margin: 6px;
      font-size: 14px;
    }
    .price {
      margin-top: 10px;
      font-weight: bold;
    }
    .note {
      font-size: 13px;
      color: #555;
    }
  </style>
</head>

<body>

<h2>ðŸŽ¬ Student Movie Show â€“ Seat Booking</h2>
<p>Enter details & select ONE seat</p>

<input id="parent" placeholder="Parent Name">
<input id="student" placeholder="Student Name">

<div class="screen">SCREEN</div>
<div id="seating"></div>

<div class="price" id="priceText">Amount: â€”</div>
<p class="note">Rows A & B: â‚¹80 | Rows Câ€“E: â‚¹50</p>

<button onclick="confirmBooking()">Confirm Booking</button>

<script>
  const rows = ['A','B','C','D','E'];
  const seatsPerRow = 10;

  let selectedSeat = null;
  let selectedAmount = 0;

  // ðŸ”´ PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL HERE
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxy592YkLxW1wqkgJcLVv7Jb32K_MZZUoQ1mamA6cAGbpAghpMcBR1sWWnEh7IzKZuBig/exec";

  function seatPrice(seatId) {
    const row = seatId.charAt(0);
    return (row === 'A' || row === 'B') ? 80 : 50;
  }

  function loadSeats() {
    fetch(SCRIPT_URL)
      .then(res => res.json())
      .then(data => drawSeats(data))
      .catch(() => drawSeats([]));   // SAFETY: always show seats
  }

  function drawSeats(bookedSeats) {
    const seatingDiv = document.getElementById("seating");
    seatingDiv.innerHTML = "";

    rows.forEach(row => {
      const rowDiv = document.createElement("div");
      rowDiv.className = "row";

      for (let i = 1; i <= seatsPerRow; i++) {
        const seatId = row + i;
        const seat = document.createElement("div");
        seat.className = "seat";
        seat.innerText = seatId;

        if (bookedSeats.includes(seatId)) {
          seat.classList.add("booked");
        }

        seat.onclick = () => selectSeat(seat, seatId);
        rowDiv.appendChild(seat);
      }

      seatingDiv.appendChild(rowDiv);
    });
  }

  function selectSeat(seat, seatId) {
    if (seat.classList.contains("booked")) {
      alert("âŒ Seat already booked");
      return;
    }

    document.querySelectorAll(".seat").forEach(s => s.classList.remove("selected"));
    seat.classList.add("selected");

    selectedSeat = seatId;
    selectedAmount = seatPrice(seatId);

    document.getElementById("priceText").innerText =
      "Amount: â‚¹" + selectedAmount;
  }

  function confirmBooking() {
    const parent = document.getElementById("parent").value.trim();
    const student = document.getElementById("student").value.trim();

    if (!parent || !student || !selectedSeat) {
      alert("âš ï¸ Please fill all details and select a seat");
      return;
    }

    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({
        parent: parent,
        student: student,
        seat: selectedSeat,
        amount: selectedAmount
      })
    })
    .then(res => res.text())
    .then(msg => {
      alert(
        "âœ… Booking Confirmed!\n" +
        "Seat: " + selectedSeat + "\n" +
        "Amount: â‚¹" + selectedAmount
      );

      selectedSeat = null;
      selectedAmount = 0;
      document.getElementById("priceText").innerText = "Amount: â€”";
      loadSeats();
    });
  }

  loadSeats();
</script>

</body>
</html>
