<!DOCTYPE html>
<html>
<head>
  <title>Student Movie Booking</title>
  <style>
    body {
      font-family: Arial;
      text-align: center;
    }
    .seat {
      width: 40px;
      height: 40px;
      margin: 4px;
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    .seat.booked {
      background: #999;
      cursor: not-allowed;
    }
    .seat.selected {
      background: #ff9800;
    }
    .row {
      margin-bottom: 6px;
    }
  </style>
</head>

<body>
<h2>üé¨ Student Movie Show Booking</h2>

<input id="parent" placeholder="Parent Name" required><br><br>
<input id="student" placeholder="Student Name" required><br><br>

<label><b>Select Time Slot</b></label><br>
<select id="slot" onchange="loadSeats()" required>
  <option value="">-- Select Slot --</option>
  <option>9:00 ‚Äì 9:30</option>
  <option>9:45 ‚Äì 10:15</option>
  <option>10:30 ‚Äì 11:00</option>
  <option>11:15 ‚Äì 11:45</option>
  <option>12:00 ‚Äì 12:30</option>
  <option>12:45 ‚Äì 1:15</option>
</select>

<h3>Select Seat</h3>
<div id="seats"></div>

<br>
<button onclick="bookSeat()">Confirm Booking</button>

<p id="result"></p>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxy592YkLxW1wqkgJcLVv7Jb32K_MZZUoQ1mamA6cAGbpAghpMcBR1sWWnEh7IzKZuBig/exec";
let selectedSeat = null;
let bookedSeats = [];

function loadSeats() {
  const slot = document.getElementById("slot").value;
  if (!slot) return;

  fetch(WEB_APP_URL)
    .then(res => res.json())
    .then(data => {
      bookedSeats = data;
      renderSeats();
    });
}

function renderSeats() {
  const container = document.getElementById("seats");
  container.innerHTML = "";
  selectedSeat = null;

  const slot = document.getElementById("slot").value;

  for (let r = 1; r <= 5; r++) {
    const rowDiv = document.createElement("div");
    rowDiv.className = "row";

    for (let c = 1; c <= 10; c++) {
      const seat = document.createElement("button");
      const label = String.fromCharCode(64 + r) + c;
      const key = slot + "_" + label;

      seat.textContent = label;
      seat.className = "seat";

      if (bookedSeats.includes(key)) {
        seat.classList.add("booked");
        seat.disabled = true;
      }

      seat.onclick = () => selectSeat(seat, label);
      rowDiv.appendChild(seat);
    }
    container.appendChild(rowDiv);
  }
}

function selectSeat(btn, label) {
  document.querySelectorAll(".seat").forEach(s => s.classList.remove("selected"));
  btn.classList.add("selected");
  selectedSeat = label;
}

function bookSeat() {
  const parent = document.getElementById("parent").value;
  const student = document.getElementById("student").value;
  const slot = document.getElementById("slot").value;

  if (!parent || !student || !slot || !selectedSeat) {
    alert("Please fill all fields and select a seat");
    return;
  }

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify({
      parent: parent,
      student: student,
      seat: selectedSeat,
      slot: slot
    })
  })
  .then(res => res.json())
  .then(resp => {
    if (resp.status === "success") {
      document.getElementById("result").innerHTML =
        `‚úÖ Seat <b>${resp.seat}</b><br>
         ‚è∞ Slot: <b>${resp.slot}</b><br>
         üí∞ Amount: <b>‚Çπ${resp.amount}</b>`;
      loadSeats();
    } else {
      alert(resp.message);
    }
  });
}
</script>

</body>
</html>
